{% extends "base.html" %}
{% block content %}
<h2 class="mb-3">Documents</h2>

{% if session.get('role') == 'admin' %}
<div class="card mb-4 shadow-sm">
  <div class="card-body">
    <h5 class="card-title">Ajouter un document</h5>
    <form action="{{ url_for('main.add_document') }}" method="POST" enctype="multipart/form-data" class="row g-3">
      <div class="col-md-3">
        <label class="form-label">Titre</label>
        <input type="text" class="form-control" name="title" required>
      </div>
      <div class="col-md-3">
        <label class="form-label">Catégorie</label>
        <select class="form-select" name="category">
          <option value="Résumé">Résumé</option>
          <option value="Exercice">Exercice</option>
          <option value="Contrôle">Contrôle</option>
          <option value="Bac blanc">Bac blanc</option>
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Fichier</label>
        <input type="file" class="form-control" name="file" required>
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <button type="submit" class="btn btn-primary w-100">Ajouter</button>
      </div>
    </form>
  </div>
</div>
{% endif %}

<table class="table table-striped table-hover align-middle">
  <thead>
    <tr>
      <th>ID</th>
      <th>Titre</th>
      <th>Catégorie</th>
      <th>Fichier</th>
      {% if session.get('role') == 'admin' %}
      <th style="width: 160px;">Actions</th>
      {% endif %}
    </tr>
  </thead>
  <tbody>
    {% for d in documents %}
    <tr>
      <td>{{ d.id }}</td>
      <td>{{ d.title }}</td>
      <td>{{ d.category }}</td>
      <td><a href="{{ url_for('main.download_document', doc_id=d.id) }}" target="_blank">{{ d.filename }}</a></td>
      {% if session.get('role') == 'admin' %}
      <td>
        <a class="btn btn-sm btn-danger" href="{{ url_for('main.delete_document', doc_id=d.id) }}"
           onclick="return confirm('Supprimer ce document ?');">Supprimer</a>
      </td>
      {% endif %}
    </tr>
    {% else %}
    <tr><td colspan="5" class="text-center">Aucun document.</td></tr>
    {% endfor %}
  </tbody>
</table>
<div id="disqus_thread" style="margin-top: 50px;"></div>
<script>
    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://ouikrimath25.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
{% endblock %}
